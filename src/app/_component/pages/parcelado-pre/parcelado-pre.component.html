<div class="row ">
	<app-notificacao [mensagem]="alertType.mensagem" [tipo]="alertType.tipo" [show]="updateLoading"></app-notificacao>

	<div class="col-md-12">
		<div class="card ">
			<div class="card-header "></div>
			<div class="card-body ">
				<div class="row">
					<div class="col-md-12">
						<app-pesquisa (contractRef)="pesquisarContratos($event)" [tableLoading]="tableLoading"
							(resetForm)="simulacao.resetForm($event)" #pesquisa></app-pesquisa>
					</div>

					<div class="col-md-12 col-sm-12">
						<app-simulacao #simulacao [updateLoadingBtn]="updateLoadingBtn"
							[tableDataLength]="tableData.dataRows.length > 0" (salvar)="atualizarRisco()"
							(simularCalculo)="simularCalc(false, 'btn')" (formValue)="setFormRiscos($event)">
						</app-simulacao>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="card ">
			<div class="card-header ">
				<h5 class="card-title">Cadastro de Parcelas</h5>
			</div>
			<div class="card-body " style="min-height: 285px;">
				<div class="row">
					<div class="col-md-12">
						<form class="row" [formGroup]="preFormCadastroParcelas">
							<div class="col-md-4 col-sm-12">
								<label for="nome" class="col-form-label">Nº Parcelas</label>
								<input type="number" (change)="verifyNumber($event)" min="0"
									class="form-control col-md-11 col-sm-12" formControlName="nparcelas" value>
							</div>
							<div class="col-md-4 col-sm-12">
								<label for="nome" class="col-form-label">Parcela inicial</label>
								<input type="number" (change)="verifyNumber($event)" min="0"
									class="form-control col-md-11 col-sm-12" formControlName="parcelaInicial" value>
							</div>
							<div class="col-md-4 col-sm-12">
								<label for="nome" class="col-form-label">Data Vencimento</label>
								<input type="date" class="form-control col-md-12 col-sm-12"
									formControlName="dataVencimento" max="3000-12-31" min="1000-01-01"> </div>
							<div class="col-md-4 col-sm-12">
								<label for="nome" class="col-form-label">Valor no Vencimento</label>
								<input type="number" (change)="verifyNumber($event)" min="0"
									class="form-control col-md-11 col-sm-12" formControlName="valorNoVencimento" value>
							</div>
							<div class="col-md-4 col-sm-12">
								<label for="nome" class="col-form-label">Status</label>
								<select class="form-control custom-select col-md-12 col-sm-12" formControlName="status">
									<option *ngFor="let status of status_field" [value]="status">
										{{status}}</option>
								</select>
							</div>

							<div class="col-md-12 col-sm-12 form-inline mt-3">
								<div class="stats form-group mb-2">
									<button type="button" (click)="adicionarParcelas()" class="btn btn-info btn-round"
										[disabled]="!preFormCadastroParcelas.valid || !pesquisa.peForm.valid">Adicionar</button>
								</div>
								<div class="stats form-group mb-2 ml-md-2">
									<button type="button" (click)="incluirParcelas()" class="btn btn-info btn-round"
										[disabled]="tableDataParcelas.dataRows.length === 0">Incluir
										Parcelas</button>
								</div>
							</div>

						</form>
						<br>
						<br>
					</div>
					<!-- Table cadastro de parcelas -->
					<div class="col-md-12" *ngIf="!(tableDataParcelas.dataRows.length === 0)">
						<table [dtOptions]="dtOptionsAmortizacao" datatable class="table table-hover">
							<thead>
								<tr align="center">
									<th>Nº Parcela</th>
									<th>Data Vencimento</th>
									<th>Valor no Vencimento</th>
									<th>Status</th>
									<th>Ações</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let row of tableDataParcelas.dataRows" align="center">
									<td>{{row.nparcelas}}</td>
									<td>
										<input type="date" class=" parcelado-font-size form-control col-md-11 col-sm-12"
											(blur)="changeCadastroParcelas($event, row, 'dataVencimento')"
											[value]="row.dataVencimento">
									</td>
									<td>
										<input class=" parcelado-font-size form-control col-md-11 col-sm-12"
											(chablurnge)="changeCadastroParcelas($event, row, 'valorNoVencimento')"
											[value]="formatCurrency(row.valorNoVencimento)">
									</td>
									<td>
										<select class="parcelado-font-size form-control custom-select"
											(change)="changeCadastroParcelas($event, row, 'status')">
											<option *ngFor="let status of status_field" [value]="status"
												[selected]="status === row.status"> {{status}}</option>
										</select>
									</td>
									<td (click)="deleteRowParcelas(row)"><i style="color: red; cursor: pointer;"
											class="nc-icon nc-simple-remove"></i></td>
								</tr>
							</tbody>
						</table>

					</div>
					<!-- Fim Table cadastro de parcelas-->
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="card " style="min-height: 350px;">
			<div class="card-header ">
				<h5 class="card-title">Amortização</h5>
			</div>
			<div class="card-body ">
				<div class="row">
					<div class="col-lg-12 col-sm-12">
						<form class="row" [formGroup]="preFormAmortizacao">
							<div class="col-md-4 col-sm-12">
								<label for="nome" class="col-form-label">Tipo Amortização</label>
								<select class="form-control custom-select col-md-12 col-sm-12"
									formControlName="preFA_tipo">
									<option *ngFor="let tipo of amortizacao_field" [value]="tipo">
										{{tipo}}
									</option>
								</select>
							</div>
							<div class="col-md-4 col-sm-12"
								[hidden]="pre_form_amortizacao.preFA_tipo.value === 'Data do Cálculo'">
								<label for="nome" class="col-form-label">Data</label>
								<input type="date" class="form-control col-md-12 col-sm-12"
									formControlName="preFA_data_vencimento" max="3000-12-31" min="1000-01-01">
							</div>
							<div class="col-md-4 col-sm-12">
								<label for="nome" class="col-form-label">Valor</label>
								<input type="number" (change)="verifyNumber($event)" min="0"
									class="form-control col-md-12 col-sm-12" name="preFA_saldo_devedor"
									style="height: 35px" id="preFA_saldo_devedor" formControlName="preFA_saldo_devedor">
							</div>
							<div class="col-sm-4">
								<br />
								<div class="stats">
									<button type="button" (click)="adicionarAmortizacao()"
										class="btn btn-info btn-round"
										[disabled]="!preFormAmortizacao.valid || !pesquisa.peForm.valid">Adicionar</button>
									<div class="d-flex justify-content-center" *ngIf="tableLoading"
										style="position: absolute; top: 33px; right: 80px">
										<div class="spinner-grow text-primary" style="width: 2rem; height: 2rem;"
											role="status"> <span class="sr-only">Loading...</span> </div>
									</div>
								</div>
							</div>
						</form>
						<br>
						<br>
					</div>
					<!-- Table amortização -->
					<div class="col-md-12" *ngIf="!(tableDataAmortizacao.dataRows.length === 0)">
						<table [dtOptions]="dtOptionsAmortizacao" datatable class="table table-hover">
							<thead>
								<tr align="center">
									<th>Data de Laçamento</th>
									<th>Valor</th>
									<th>Tipo</th>
									<th>Ações</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let row of tableDataAmortizacao.dataRows" align="center">
									<td>{{formatDate(row.preFA_data_vencimento)}}</td>
									<td>{{formatCurrency(row.preFA_saldo_devedor)}}</td>
									<td>{{row.preFA_tipo}}</td>
									<td (click)="deleteRowAmortizacao(row)"><i style="color: red; cursor: pointer;"
											class="nc-icon nc-simple-remove"></i></td>
								</tr>
							</tbody>
						</table>
					</div>
					<!-- Fim Table amortização-->
				</div>
				<br>
			</div>
		</div>
	</div>
	<div class="col-md-12 col-sm-12 pt-0" *ngIf="!(tableData.dataRows.length === 0)">
		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<h4 class="card-title">DEMONSTRATIVO DE SALDO DEVEDOR</h4>
					</div>
					<div class="card-body" style="max-height: 100vh;overflow: scroll;">
						<table [dtOptions]="dtOptions" datatable class="table table-hover"
							*ngIf="tableData && tableData.dataRows && !tableLoading" style="width: 100%;" id="tablePre">
							<thead>
								<tr align="center">
									<th colspan="8"></th>
									<th width="400" colspan="5">Encargos Moratórios</th>
									<th colspan="5">
									<th colspan="3"> </th>
								</tr>
								<tr align="center">
									<th class="align-title-top" rowspan="2">Nº Parcela</th>
									<th class="align-title-top" rowspan="2">Data Vencimento</th>
									<th class="align-title-top" rowspan="2">Índice
										<b>{{formDefaultValues.formIndice}}</b> </th>
									<th width="80" class="align-title-top" rowspan="2">Índice Data Vencimento</th>
									<th class="align-title-top" rowspan="2">Data Cálculo / Amort.</th>
									<th class="align-title-top" rowspan="2">Índice
										<b>{{formDefaultValues.formIndice}}</b> </th>
									<th width="80" class="align-title-top" rowspan="2">Índice Data Cálculo / Amort.
									</th>
									<th class="align-title-top" rowspan="2">Valor no Vencimento R$</th>
									<th width="100" rowspan="2">Correção pelo Índice</th>
									<th colspan="3">Juros a.m. {{(formDefaultValues.formJuros ||  0 ) + "%"}} </th>
									<th width="100" rowspan="2">Multa
										<b>{{(formDefaultValues.formMulta || 0 ) + "%"}}</b> </th>
									<th class="align-title-top" rowspan="2">Subtotal</th>
									<th width="80" class="align-title-top" rowspan="2">Valor da PMT Vincenda em
										<b>{{tableData.dataRows.length ? formatDate(tableData.dataRows[0]['dataCalcAmor']) : ''}}</b>
									</th>
									<th width="80" class="align-title-top" rowspan="2">Amortização</th>
									<th width="80" class="align-title-top" rowspan="2">Total Devedor</th>
									<th width="80" class="align-title-top" rowspan="2">Status</th>
									<th width="80" class="align-title-top log-hidden-false" rowspan="2">Ação</th>
								</tr>
								<tr align="center">
									<th>Dias</th>
									<th>%</th>
									<th>R$</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let row of tableData.dataRows" class="parcelado-font-size" align="center">
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}"> {{row.nparcelas}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										<input type="date" [ngClass]="{'parcelas-vincendas': row.vincenda} "
											class=" parcelado-font-size form-control col-md-11 col-sm-12 log-hidden-false"
											name="pre_dataVencimento" id="pre_dataCalcAmor" [value]="row.dataVencimento"
											(blur)="changeDate($event, row, 'dataVencimento', 'indiceDV', 'indiceDataVencimento')">
										<span class="log-visible-false">{{formatDate(row.dataVencimento)}}</span>
									</td>
									<td width="80" [ngClass]="{'parcelas-vincendas': row.vincenda}">
										<select [ngClass]="{'parcelas-vincendas': row.vincenda}"
											class="parcelado-font-size form-control custom-select log-hidden-false"
											name="pre_indiceDV" id="pre_indiceDV"
											(change)="updateInlineIndice($event.target.value, row, 'indiceDataVencimento', 'indiceDV', 'dataVencimento')">
											<option *ngFor="let indice of indice_field" [value]="indice"
												[selected]="indice === row.indiceDV"> {{indice}}</option>
										</select>
										<span class="log-visible-false">{{row.indiceDV}}</span>

									</td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{row.indiceDataVencimento || "---"}}
									</td>
									<td width="120" [ngClass]="{'parcelas-vincendas': row.vincenda}">
										<input [ngClass]="{'parcelas-vincendas': row.vincenda}" type="date"
											class="parcelado-font-size form-control col-md-11 col-sm-12 log-hidden-false"
											name="pre_dataCalcAmor" id="pre_dataCalcAmor" max="3000-12-31"
											[value]="row.dataCalcAmor"
											(blur)="changeDate($event, row, 'dataCalcAmor', 'indiceDCA', 'indiceDataCalcAmor')">
										<span class="log-visible-false">{{formatDate(row.dataCalcAmor)}}</span>

									</td>
									<td width="80" [ngClass]="{'parcelas-vincendas': row.vincenda}">
										<select [ngClass]="{'parcelas-vincendas': row.vincenda}"
											class="parcelado-font-size form-control custom-select log-hidden-false"
											name="pre_indice" id="pre_indice"
											(change)="updateInlineIndice($event.target.value, row, 'indiceDataCalcAmor', 'indiceDCA', 'dataCalcAmor')">
											<option *ngFor="let indice of indice_field" [value]="indice"
												[selected]="indice === row.indiceDCA"> {{indice}}</option>
										</select>
										<span class="log-visible-false">{{row.indiceDCA}}</span>

									</td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{row.indiceDataCalcAmor || "---"}}
									</td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrency(row.valorNoVencimento)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrency(row.encargosMonetarios.correcaoPeloIndice)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{row.encargosMonetarios.jurosAm.dias || 0}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{row.encargosMonetarios.jurosAm.percentsJuros || 0}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrency(row.encargosMonetarios.jurosAm.moneyValue)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrency(row.encargosMonetarios.multa)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrency(row.subtotal)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrency(row.valorPMTVincenda)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrencyAmortizacao(row.amortizacao)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}">
										{{formatCurrency(row.totalDevedor)}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}"> {{row.status}} </td>
									<td [ngClass]="{'parcelas-vincendas': row.vincenda}" class="log-hidden-false"
										(click)="deleteRow(row)"><i style="color: red; cursor: pointer;"
											class="nc-icon nc-simple-remove"></i>
									</td>
								</tr>
							</tbody>
							<tfoot>
								<tr class="parcelado-font-size">
									<th class="footer-table footer-title-table" colspan="7">TOTAL DE PARCELAS
										VENCIDAS
									</th>
									<th class="footer-table" width="100" colspan="1">
										{{formatCurrency(totalParcelasVencidas.valorNoVencimento)}}</th>
									<th class="footer-table" width="100" colspan="1">
										{{formatCurrency(totalParcelasVencidas.correcaoPeloIndice)}}</th>
									<th class="footer-table"></th>
									<th class="footer-table"></th>
									<th class="footer-table">{{formatCurrency(totalParcelasVencidas.moneyValue)}}
									</th>
									<th class="footer-table">{{formatCurrency(totalParcelasVencidas.multa)}}</th>
									<th class="footer-table">{{formatCurrency(totalParcelasVencidas.subtotal)}}</th>
									<th class="footer-table"></th>
									<th class="footer-table">{{formatCurrency(totalParcelasVencidas.amortizacao)}}
									</th>
									<th class="footer-table">{{formatCurrency(totalParcelasVencidas.totalDevedor)}}
									</th>
									<th class="footer-table"></th>
									<th class="footer-table log-hidden-false"></th>
								</tr>
								<tr align="left" class="parcelado-font-size">
									<th class="footer-table footer-title-table" colspan="7">TOTAL DE PARCELAS
										VINCENDAS
									</th>
									<th class="footer-table" width="100" colspan="1"></th>
									<th class="footer-table" width="100" colspan="1"></th>
									<th class="footer-table" colspan="1"></th>
									<th class="footer-table" colspan="1"></th>
									<th class="footer-table"></th>
									<th class="footer-table"></th>
									<th class="footer-table"></th>
									<th class="footer-table">
										{{formatCurrency(totalParcelasVincendas.valorPMTVincenda)}}
									</th>
									<th class="footer-table"></th>
									<th class="footer-table">{{formatCurrency(totalParcelasVincendas.totalDevedor)}}
									</th>
									<th class="footer-table"></th>
									<th class="footer-table log-hidden-false"></th>
								</tr>
							</tfoot>
						</table>
						<div class="d-flex justify-content-center" *ngIf="tableLoading" style="padding: 200px">
							<div class="spinner-grow text-primary" style="width: 4rem; height: 4rem;" role="status">
								<span class="sr-only">Loading...</span> </div>
						</div>
					</div>
					<div class="card-footer" *ngIf="tableData.dataRows.length > 0 && !tableLoading">
						<div class="row">
							<div class="col-md-10">
								<p>Subtotal Devedor em {{ subtotal_data_calculo || "---------"}}</p>
								<p>Amortização</p>
								<p>Honorários {{formDefaultValues.formHonorarios || 0}}%</p>
								<p>Multa sob contrato {{formDefaultValues.formMultaSobContrato || 0}}%</p>
								<p>TOTAL SALDO DEVEDOR EM {{total_data_calculo || "---------"}}</p>
							</div>
							<div class="col-md-2">
								<p>{{formatCurrency(total_subtotal || 0)}}</p>
								<p>{{formatCurrencyAmortizacao(amortizacaoGeral || 0)}}</p>
								<p>{{formatCurrency(total_honorarios || 0)}}</p>
								<p>{{formatCurrency(total_multa_sob_contrato || 0)}}</p>
								<p>{{formatCurrency(total_grandtotal || 0)}}</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>